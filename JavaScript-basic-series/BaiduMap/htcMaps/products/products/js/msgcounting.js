function MsgCounting(t){this.name="获取当前用户反馈的未读数据",this.fkData=[],this.allId="",this.creatId="",this.readData=[],this.fankuiNum=0,this.mailNum=0,this.totalNum=0,this.init()}function getCookie(t){for(var a=t+"=",i=document.cookie.split(";"),e=0;e<i.length;e++){var n=i[e].trim();if(0==n.indexOf(a))return n.substring(a.length,n.length)}return""}$(document).ready(function(){var t=60,a=getCookie("alert_show");a&&$(".nav-fankui").css("display","none"),$(".close-alert").on("click",function(){$(".nav-fankui").css("display","none"),document.cookie="alert_show= true"}),setInterval(function(){--t,0===t&&($(".nav-fankui").css("display","none"),document.cookie="alert_show= true")},1e3);new MsgCounting}),MsgCounting.prototype={constructor:MsgCounting,init:function(){this.checkLogin()},checkLogin:function(){var t=this;$.ajax({type:"GET",url:"https://passport.baidu.com/v2/api/checkfacticity",dataType:"jsonp",timeout:1e4,xhrFields:{withCredentials:!0},success:function(a){if(a.facticity){t.toTalindex=0;var i=sessionStorage.getItem("sucstimetamp");null!=i&&void 0!==i||(i=0);var e=Date.parse(new Date);Number(e)-Number(i)>12e4?t.firistlist():(t.mailNum=Number(sessionStorage.getItem("unReadnum")),t.mailNum>0?($("#mailNum").find("strong").text(t.mailNum),$("#mailNum").show()):(t.mailNum=0,$("#mailNum").find("strong").text(t.mailNum),$("#mailNum").hide()),t.toTalindex++,2===t.toTalindex&&(t.toTalindex=0,t.toalShow())),t.getUfoData()}else sessionStorage.setItem("msgListOf","false")},error:function(t){}})},firistlist:function(){var t=this,a={showlist:2};$.ajax({type:"POST",url:"/apiconsole/mail/firstList",dataType:"json",data:a,crossDomain:!0,success:function(a){0===a.status&&t.getMailNum()},error:function(t){}})},getMailNum:function(){var t=this,a={};$.ajax({type:"POST",url:"/apiconsole/mail/getMsgUnread",dataType:"json",data:a,crossDomain:!0,success:function(a){if(0===a.status){t.mailNum=a.info.data.data.unread_count,t.mailNum>0?($("#mailNum").find("strong").text(t.mailNum),$("#mailNum").show()):(t.mailNum=0,$("#mailNum").find("strong").text(t.mailNum),$("#mailNum").hide());var i=Date.parse(new Date);sessionStorage.setItem("sucstimetamp",i),sessionStorage.setItem("unReadnum",t.mailNum),t.toTalindex++,2===t.toTalindex&&(t.toTalindex=0,t.toalShow())}},error:function(t){}})},getUfoData:function(){var t=this,a={appid:215631,product_line:20159,page:1,numPerPage:10,status:"2"};$.ajax({type:"POST",url:"http://ufosdk.baidu.com/?m=Api&a=myhistory&method=getFeedbackList",dataType:"jsonp",data:a,xhrFields:{withCredentials:!0},crossDomain:!0,success:function(a){0===a.error_no&&(t.fankuiNum=0,t.fkData=a.result.data,t.fkData.length>0?t.getAllID():(t.toTalindex++,2===t.toTalindex&&(t.toTalindex=0,t.toalShow())))},error:function(t){}})},getAllID:function(){for(var t=this,a="",i=0;i<t.fkData.length;i++)a+=t.fkData[i].extend_sdk_id+",";t.allId=a.substring(0,a.length-1),t.allId.length>0?t.readDataApi("list"):(t.toTalindex++,2===t.toTalindex&&(t.toTalindex=0,t.toalShow()))},readDataApi:function(t){var a=this;if("list"===t)var i={method:t,problem_id_list:this.allId};else var i={method:t,problem_id_list:this.creatId,status:1};$.ajax({type:"POST",url:"/apiconsole/fankui/read",dataType:"json",data:i,crossDomain:!0,success:function(t){0===t.status?(a.readData=t.info,a.getReadNum()):(a.toTalindex++,2===a.toTalindex&&(a.toTalindex=0,a.toalShow()))},error:function(t){}})},getReadNum:function(){var t=this,a="";if(this.readData.length>0){for(var i=0;i<this.readData.length;i++)"1"!==this.readData[i].status&&"2"!==this.readData[i].status||(this.fankuiNum++,"2"===this.readData[i].status&&(a+=this.readData[i].problem_id+","));this.creatId=a.substring(0,a.length-1)}this.creatId.length>1&&this.readDataApi("modify"),this.fankuiNum>0?($("#fanKuiNum").find("strong").text(this.fankuiNum),$("#fanKuiNum").show()):($("#fanKuiNum").find("strong").text(this.fankuiNum),$("#fanKuiNum").hide()),t.toTalindex++,2===t.toTalindex&&(t.toTalindex=0,t.toalShow())},toalShow:function(){this.toTalindex=0,this.totalNum=Number(this.mailNum)+Number(this.fankuiNum),this.totalNum>0?($("#totalNum").text(this.totalNum),$("#totalNum").show()):($("#totalNum").text(this.totalNum),$("#totalNum").hide())}};